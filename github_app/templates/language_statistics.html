<!-- language_statistics.html -->

{% extends 'base.html' %}

{% block title %}Language Usage Statistics{% endblock %}

{% block content %}
<div class="container">
    <h1>Language Usage Statistics</h1>

    <!-- Table with statistics -->
    <table id="language-table" class="table table-striped">
        <thead>
        <tr>
            <th>Language</th>
            <th>Usage (%)</th>
        </tr>
        </thead>
        <tbody>
        {% for language, percentage in language_percentages %}
        <tr data-language="{{ language }}">
            <td>{{ language }}</td>
            <td>{{ percentage|floatformat:2 }}%</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Container for time-series chart -->
    <canvas id="timeSeriesChart"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Prepare data for time-series chart
            const timeSeriesData = {{ languages_activity|safe }};
            const timeSeriesCtx = document.getElementById('timeSeriesChart').getContext('2d');

            // Prepare labels and datasets
            const languages = Object.keys(timeSeriesData);
            const labels = Array.from(new Set(languages.flatMap(lang => Object.keys(timeSeriesData[lang])))).sort();
            const datasets = languages.map(language => ({
                label: language,
                data: labels.map(label => timeSeriesData[language][label] || 0),
                borderColor: getRandomColor(),
                backgroundColor: getRandomColor(0.2),
                fill: true,
            }));

            new Chart(timeSeriesCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets,
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Lines of Code'
                            }
                        }
                    }
                }
            });

            function getRandomColor(alpha = 1) {
                return `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${alpha})`;
            }
        });

    </script>

</div>
{% endblock %}
